{% metadata_file .yamato/project.metafile %}
---

# Run all relevant tasks when a pull request targeting the develop or release branch is created or updated.
pull_request_trigger:
  name: Pull Request Trigger (develop, develop-2.0.0, & release branches)
  dependencies:
    # Run project standards to verify package/default project. This is fine to just run for trunk
    - .yamato/project-standards.yml#standards_ubuntu_testproject_trunk
    # Run package EditMode and Playmode package tests on trunk
    - .yamato/_run-all.yml#run_all_package_tests_trunk
    # Run package EditMode and Playmode package tests on minimum supported editor (2021.3 in case of NGOv1.X)
    - .yamato/_run-all.yml#run_all_package_tests_2021
    # Run project EditMode and PLaymode project tests on trunk 
    - .yamato/_run-all.yml#run_all_project_tests_trunk
    # Run project EditMode and PLaymode project tests on minimum supported editor (2021.3 in case of NGOv1.X)
    - .yamato/_run-all.yml#run_all_project_tests_2021
    # Run one standalone test to make sure there are no obvious issues with most common platform (for example --fail-on-assert option is not present with package/project tests). We run 2 different combinations (platform/editor)
    - .yamato/desktop-standalone-tests.yml#desktop_standalone_test_testproject_win_il2cpp_trunk
    - .yamato/desktop-standalone-tests.yml#desktop_standalone_test_testproject_win_mono_2021.3
  triggers:
    cancel_old_ci: true
    pull_requests:
      - targets:
          only:
            - "develop"
            - "develop-2.0.0"
            - "/release\/.*/"
      - drafts: false
            

# Run all tests on trunk on nightly basis.
# Same subset as pull_request_trigger with addition of mobile/desktop/console tests and webgl builds
# Those tests are all running on trunk editor (since it's daily and running all of them would add a lot of overhead)
develop_nightly:
  name: "\U0001F319 [Nightly] Run All Tests [Trunk and 2021]"
  triggers:
    recurring:
      - branch: develop
        frequency: daily
        rerun: always
  dependencies:
    # Run project standards to verify package/default project
    - .yamato/project-standards.yml#standards_ubuntu_testproject_trunk
    - .yamato/project-standards.yml#standards_ubuntu_testproject_2021.3
    # Run APV jobs to make sure the change won't break any dependants
    - .yamato/wrench/preview-a-p-v.yml#all_preview_apv_jobs
    # Run package EditMode and Playmode tests on desktop platforms on trunk and 2021.3
    - .yamato/_run-all.yml#run_all_package_tests_trunk
    - .yamato/_run-all.yml#run_all_package_tests_2021
    # Run project EditMode and PLaymode tests on desktop platforms on trunk and 2021.3 
    - .yamato/_run-all.yml#run_all_project_tests_trunk
    - .yamato/_run-all.yml#run_all_project_tests_2021
    # Run Runtime tests on desktop players on trunk and 2021 editors
    - .yamato/_run-all.yml#run_all_project_tests_desktop_standalone_trunk
    - .yamato/_run-all.yml#run_all_project_tests_desktop_standalone_2021
    # Run Runtime tests on mobile players on trunk and 2021 editors
    - .yamato/_run-all.yml#run_all_project_tests_mobile_standalone_trunk
    - .yamato/_run-all.yml#run_all_project_tests_mobile_standalone_2021
    # Run Runtime tests on console players on trunk and 2021 editors
    - .yamato/_run-all.yml#run_all_project_tests_console_standalone_trunk
    - .yamato/_run-all.yml#run_all_project_tests_console_standalone_2021
    # Build player for webgl platform on trunk and 2021 editors
    - .yamato/_run-all.yml#run_all_webgl_builds_trunk
    - .yamato/_run-all.yml#run_all_webgl_builds_2021
    # Build player for webgl platform on trunk and 2021 editors
    - .yamato/project-updated-dependencies-test.yml#updated-dependencies_testproject_NGO_ubuntu_trunk
    - .yamato/project-updated-dependencies-test.yml#updated-dependencies_testproject_NGO_win_2021.3


# Run all tests on weekly bases
# Same subset as develop_nightly but runs per all supported editors as well as executes code coverage test and runs project standards per project
# It's not running wrench jobs since those will run either way in nightly test run
# This in contrast to nightly checks will run tests on all editors (not only trunk). Running those on weekly basis and trunk tests nightly should be a good balance between making sure that tests are passing and overhead of running lots of tests
develop_weekly_trunk:
  name: "\U0001F319 [Weekly] Run All Tests"
  triggers:
    recurring:
      - branch: develop
        frequency: weekly
        rerun: always
  dependencies:
    # Run project standards to verify package/default project
    - .yamato/_run-all.yml#run_all_projects_standards
    # Run package EditMode and Playmode tests on desktop platforms
    - .yamato/_run-all.yml#run_all_package_tests
    # Run project EditMode and PLaymode tests on desktop platforms
    - .yamato/_run-all.yml#run_all_project_tests
    # Run Runtime tests on desktop players
    - .yamato/_run-all.yml#run_all_project_tests_desktop_standalone
    # Run Runtime tests on mobile players
    - .yamato/_run-all.yml#run_all_project_tests_mobile_standalone
    # Run Runtime tests on console players
    - .yamato/_run-all.yml#run_all_project_tests_console_standalone
    # Build player for webgl platform on trunk
    - .yamato/_run-all.yml#run_all_webgl_builds
    # Run code coverage test
    - .yamato/code-coverage.yml#code_coverage_ubuntu_trunk