{% metadata_file .yamato/project.metafile %}
---

# Packs Netcode for GameObjects together with performing initial checks. 
# For this job no specific platform support and no running Unity instance is required so small agent (as per project.metafile definition) could be used to save resources and speed up the process.
# If everyone adheres to this rule it can create bottlenecks (since everyone would use this machine) so we decided to pack with the same platform as the given job runs on
{% for platform in test_platforms.desktop -%}
package_pack_-_ngo_{{ platform.name }}:
  name: Package Pack (and x-ray) - NGO [{{ platform.name }}]
  agent:
    type: {{ platform.type }}
    image: {{ platform.image }}
    flavor: {{ platform.flavor }}
  timeout: 0.25
  variables:
    XRAY_PROFILE: "supported ./pvpExceptions.json"
  commands:
    - upm-pvp pack "com.unity.netcode.gameobjects" --output upm-ci~/packages
    - upm-pvp xray --packages "upm-ci~/packages/com.unity.netcode.gameobjects*.tgz" --results pvp-results
    - upm-pvp require {% if platform.name == "win" %}"%XRAY_PROFILE%"{% else %}"$XRAY_PROFILE"{% endif %} --results pvp-results --allow-missing
  artifacts:
    logs:
      paths:
        - "pvp-results/*"
    packages:
      paths:
        - "upm-ci~/**"
{% endfor -%}